\chapter{Riemann积分}

\section{Riemann可积的定义}

我们先来看一个例子: 尝试计算(定义)抛物线$y=x^2,0\leq x \leq 1$与$x$轴围成的面积. 一种自然的思路是利用矩形进行逼近, 因为我们可以简单地定义出矩形的面积. 具体来说, 考虑$[0,1]$区间的一个分割$\pi = \{ 0=x_0<x_1<\cdots <x_{n-1}<x_n=1 \}$, 并在每个小区间内部取点$\xi _i \in [x_{i-1},x_i]$, 记$\xi = \{ \xi _1,\cdots ,\xi _n \}$. 我们希望定义如下的极限就是所求面积: $$\lim_{\| \pi \| \to 0} \sum_{i=1}^{n}(x_i-x_{i-1})\xi _i^2. $$
其中, 极限过程$\| \pi \| \to 0$的意思是$\max_{1\leq i \leq n} \{x_i-x_{i-1}\} \to 0$(这的确构成一种极限过程, 后面会证明). 

这种定义有非常明显的问题: 
\begin{itemize}
	\item 分割$\pi$和标记点$\xi$并不确定, 因而无法很方便地计算这个极限. 
	\item 由于不便将该式化简, 我们甚至不知道这样的极限是否存在. 
\end{itemize}
针对这两个问题, 可能会有如下想法: 
\begin{itemize}
	\item 用平均分割和统一的标记点选取标准来代替一般化的方法. 注意这种计算方式一定是充分条件. 
	\item 类似于数列, 既然难以判断极限是否存在, 可以考虑定义上下极限来逼近. 
\end{itemize}
综合这两种想法, 在本例中我们可以如下考察所求的面积: 首先取平均分割$\pi_{n}=\{ x_i=\frac{i}{n} \}$, 接着选择两种不同的标记点集$\displaystyle\xi _L = \big\{ \xi _i :  \xi _i ^2= \inf_{x_{i-1} \leq x \leq x_i} x^2 \big\}$, $\displaystyle\xi _U = \big\{ \xi _i : \xi _i ^2= \sup_{x_{i-1} \leq x \leq x_i} x^2 \big\}$. 考虑极限过程$n\to \infty$, 于是两种极限$S_L$和$S_U$就是: $$S_L = \lim_{n\to \infty} \left( \frac{1}{n} \sum_{i=1}^{n} \frac{(i-1)^2}{n^2} \right) = \lim_{n\to \infty} \frac{2n^2-3n+1}{6n^2} = \frac{1}{3} ,  $$
$$S_U = \lim_{n\to \infty} \left( \frac{1}{n} \sum_{i=1}^{n} \frac{i^2}{n^2} \right) = \lim_{n\to \infty} \frac{2n^2+3n+1}{6n^2} = \frac{1}{3}.$$
注意到$S_L=S_U = \frac{1}{3}$, 于是所求面积(似乎)就是$\frac{1}{3}$. 

上面的例子就是利用Riemann和进行逼近计算(定义)的做法. 我们不难想到另一种方法: 先定义所谓阶梯函数(这种函数的积分易于定义), 再考虑找到特定函数的阶梯函数逼近, 最后计算极限阶梯函数的积分即可. 这两种方法本质上是相同的, 只是操作顺序不一样. 然而利用后者有两个优势: 我们能够自然地理解Riemann积分的某些缺陷(例如只能处理有界函数), 另外实际上Riemann和的定义无法推广到$\R ^n$上(依赖序关系). 


\subsection{阶梯函数及其积分}

首先我们考虑\textit{示性函数}(characteristic function): 设$E \subseteq \R$, 则定义$$\chi _{E}:\R \to \{ 0,1 \},\quad \chi _{E} (x) = \begin{cases}
	1 & x \in E \\ 0 & x \notin E
\end{cases}.$$
我们希望定义$\chi _E$的积分, 而这自然需要定义集合$E$的长度. 我们不希望引入繁杂的测度理论, 于是承认下方的“公理”: 对于某个将集合映射到其对应长度的函数$\mu$, 我们希望有$$\mu ((a,b)) = \mu ([a,b]) = \mu ([a,b)) = \mu ((a,b]) = b-a, $$
$$\mu ((-\infty ,+\infty)) = \mu ((-\infty ,b)) = \mu ((a ,+\infty)) = +\infty .$$
第一行的“公理”也在告诉我们: 像$a,b$这样的点是没有长度的. 

于是, 我们可以定义示性函数的\textit{积分}(integral)为$$\int \chi _E := \mu (E). $$
特别地, $$\int \chi _{(a,b)} = \int \chi _{[a,b]} = \int \chi _{[a,b)} = \int \chi _{(a,b]} = b-a. $$
当然, 实际定义阶梯函数的积分时只需要用到$E$是区间的情况, 因此上方不严谨的思考并不影响结果的正确性. 

接下来看\textit{阶梯函数}(更多时候称为\textit{简单函数}, simple function): 

\begin{definition}{分划, 阶梯函数, 阶梯函数的积分}
	设闭区间$I=[a,b]$. 
	\begin{itemize}
		\item 称形如$$\pi = \{ a=x_0<x_1<\cdots <x_{n-1}<x_n=b \}$$
		的集合为$I$的一个\textit{分划}(partition). 
		\item 定义分划$\pi$的\textit{步长}(step): $$\| \pi \| := \max_{1 \leq i \leq n} \{ x_i-x_{i-1} \}. $$
		\item 对于分划$\pi= \{ a=x_0<\cdots <x_n=b \}$, 称形如$$f = \sum_{i=1}^{n} \lambda _i \chi _{(x_{i-1},x_{i})} $$
		(其中$\lambda _i \in \R$)的函数为$\pi$上的一个\textit{阶梯函数}. 记$I$上全体阶梯函数的集合为$\mathcal{S}(I)$. 
		\item 承上一条, 定义$f$的\textit{积分}(integral)为$$\int f := \sum_{i=1}^{n} \lambda _i \int \chi _{(x_{i-1},x_i)} = \sum_{i=1}^{n} \lambda _i (x_i-x_{i-1}). $$
	\end{itemize}
\end{definition}
\begin{remark}
	刚才说过, 点是没有长度的, 因此阶梯函数在分割点处的取值应当对最终结果没有影响. 
\end{remark}
\begin{remark}
	为了避免与原函数的符号相混淆, 也记$\int f = \int _I f = \int_a^b f$. 不过为了方便, 我们暂时混用这些符号. 
\end{remark}

这里, 我们实际上需要验证阶梯函数积分的良定义性. 也就是说, 如果$\pi, \pi '$均与$f$相容, 则$f$依这两种分划的积分相等. 一般地, 我们称$\pi ' \prec \pi$($\pi '$比$\pi$细), 如果$\pi$的分割点都是$\pi '$的分割点. 于是我们只需要验证, 若$\pi ' \prec \pi$, 则$f$依这两种分划的积分相等(这是因为我们可以取$\overline{\pi} = \pi \cup \pi '$). 而这是显然的. 

接下来研究积分算子的性质: 

\begin{proposition}{阶梯函数积分算子的性质}
	设闭区间$I=[a,b]$. 设$f,g \in \mathcal{S}(I)$. 则$\int : \mathcal{S}(I) \to \R$满足: 
	
	a) 线性: $$\int (\lambda f+ \mu g) = \lambda \int f + \mu \int g.$$
	
	b) 区间可加性: 设$I=[a,c] \cup [c,b]$, 则$$\int_a^b f = \int_a^c f + \int_c^b f. $$
	
	c) 三角不等式: $$\left| \int f \right| \leq \int |f|. $$
	
	d) 保号性/保序性: 若$f \geq 0$, 则$$\int f \geq 0. $$
	\qquad 特别地, 若$f \leq g$, 则$$ \int f \leq  \int g.$$
	
	e) 对积分的估计: 选取与$f$相容的分划$\pi= \{ a=x_0<\cdots <x_n=b \}$后, $$\left| \int_a^b f \right| \leq |b-a| \sup_{1 \leq i \leq n} |\lambda _i|. $$
\end{proposition}
\begin{proof}
	注意到阶梯函数是有限求和, 诸命题的验证就是显而易见的了. 
\end{proof}

\subsection{Riemann可积的定义}

现在来对一般函数定义Riemann积分. 首先是从阶梯函数角度出发: 

\begin{definition}{Riemann可积}
	设闭区间$I=[a,b]$. 称$f$是\textit{Riemann可积的}, 如果对任意$\varepsilon >0$均存在$F,e \in \mathcal{S}(I)$使得$$\forall x \in I,|f(x)-F(x)|<e(x),\qquad \int e < \varepsilon .$$
	特别地, 全体$I$上Riemann可积的函数构成集合$\mathcal{R}(I)$. 
\end{definition}

我们需要对上述定义中的$F$逐个求积分并取其“极限”. 从上方的定义, 我们不难想到类似于序列逼近函数极限的思路: 考虑某种意义上的一列逼近函数$\{ f_n \}$, 然后定义$$\int f := \lim_{n\to \infty} \int f_n.$$

\begin{proposition}{}
	设闭区间$I=[a,b]$. 则下列说法等价: 
	\begin{itemize}
		\item $f$是Riemann可积的. 
		\item 存在阶梯函数序列$\{ f_n \},\{ e_n \}$使得$$\forall x \in I,|f(x)-f_n(x)|<e_n(x),\qquad \lim_{n\to \infty} \int e_n = 0.$$
		并且令$$\int f := \lim_{n\to \infty} \int f_n .$$
	\end{itemize}
\end{proposition}
\begin{proof}
	1) $\Rightarrow$ 2): 对任意$n>0$, 存在$f_n$使得$|f(x)-f_n(x)|<e_n(x)$使得$\int e_n < 1/n$, 从而$\lim_{n\to \infty} \int e_n = 0$. 
	
	2) $\Rightarrow$ 1): 显然. 
	
	另外, 我们还需证明$\int f = \lim_{n\to \infty} \int f_n$是良定义的, 即极限存在且不依赖于$\{ f_n \}$的选取: 
	
	由于$|f_n(x)-f_m(x)| \leq |f(x)-f_n(x)| + |f(x)-f_m(x)| \leq e_n(x)+e_m(x)$, 在两边积分可得$$\left| \int f_n-\int f_m \right| \leq \int |f_n-f_m| \leq \int e_n + \int e_m \to 0.$$
	这说明$\{ \int f_n \}$是Cauchy列, 进而存在极限. 
	
	另一方面, 设有另外的$\{ f'_n \}$和$\{ e'_n \}$符合要求, 则$|f_n(x)-f'_n(x)| \leq |f(x)-f_n(x)| + |f(x)-f'_n(x)| \leq e_n(x)+e'_n(x)$, 两侧积分可得$$\left| \int f_n - \int f'_n \right| \leq \int |f_n-f'_n| \leq \int e_n+ \int e'_n \to 0.$$
	于是两个极限相等. 
\end{proof}

接着从Riemann和角度出发. 类似于前文的例子, 如下定义: 基于分割点集$\pi$和标记点集$\xi$, 则$f$的\textit{Riemann和}为: $$S(f;\pi ,\xi) := \sum_{i=1}^{n} (x_i-x_{i-1})f(\xi _i) .$$
对于取定的函数$f$, 定义它的基为$\mathcal{B} := \{ B_{\delta}:\delta >0 \}$, 其中$B_{\delta} := \{ (\pi ,\xi) : \| \pi \|< \delta \}$. 不难证明, 这的确是一个基. 

\begin{proposition}{}
	设闭区间$I$, $f$在$I$上Riemann可积, 则
	\begin{center}
		$\displaystyle \lim_{\mathcal{B}} S(f;\pi ,\xi) = \int_I f.$
	\end{center}
\end{proposition}
\begin{proof}
	任取$\varepsilon >0$, 设阶梯函数$F,e$使得$|f(x)-F(x)|<e(x)$且$\int e(x) < \varepsilon$, 且不妨设$F,e$的分割点集均为$\pi _0 =\{ a=x_0<\cdots <x_n=b \}$. 待定分割点集$\pi = \{ a=y_0<\cdots <y_m=b \}$和与之对应的任意标记集$\xi$. 令$\| \pi \| < \min_{1 \leq i \leq n} \{ x_i-x_{i-1} \}$, 于是$$\left| S(f;\pi ,\xi) - \int_I f \right| \leq \sum_{i=1}^{m} \left| f(\xi _i)-\int_{y_{i-1}}^{y_i} f \right|. $$
	对$i$, 分情况讨论: 
	
	若$(y_{i-1},y_i)$完全包含在某个$(x_{j-1},x_j)$中: 易知$|f(x)-f(\xi _i)| \leq |f(x)-F(x)| + |F(\xi _i)-f(\xi _i)| \leq e(x)+e(\xi _i)$, 
	从而$$\left| f(\xi _i)-\int_{y_{i-1}}^{y_i} f \right| \leq 2\int_{y_{i-1}}^{y_i} e.$$
	
	若$(y_{i-1},y_i)$恰包含某个$x_j$: 由$f$可积知$f$有界, 设$|f(x)|<M$. 此时有$$\left| f(\xi _i)-\int_{y_{i-1}}^{y_i} f \right| \leq 2(y_i-y_{i-1})M \leq 2\| \pi \|M.$$
	
	综上可得, $$\left| S(f;\pi ,\xi) - \int_I f \right| \leq 2\sum_{i=1}^{m} \int_{y_{i-1}}^{y_i} e + 2n\| \pi \|M \leq 2\varepsilon + 2nM\| \pi \|.$$
	先令$\| \pi \|\to 0$, 则$\limsup_{\| \pi \|\to 0} LHS \leq 2\varepsilon$. 再令$\varepsilon \to 0$即得. 
\end{proof}


\subsection{非负函数的积分, 连接阶梯函数与Riemann和的途径}

从坐标图上来看, 将$f$拆分为非负部分$f^+$和非正部分$f^-$再分别计算两部分的积分似乎是一个可行的方法, 即令$f=f^+-f^-$, 之后定义非负函数$g$的积分为$$\int g := \sup \left\{ \int G:0\leq G \leq g, G \in \mathcal{S}(I)  \right\}, $$
最后令$\int f = \int f^+ - \int f^-$. 

我们先来研究最简单的情形, 即$f$本身就是非负函数: 

\begin{proposition}{} \label{pro:fwfuhjuubijb}
	设闭区间$I=[a,b]$, $f \geq 0$. 则在下列说法中, 1)可以推出2), 而2)加上条件$$\sum_{i=1}^{\ell} \omega (f,(x_{i-1},x_i)) (x_i-x_{i-1}) \to 0,\quad \| \pi \| \to 0$$可以推出1). 
	\begin{itemize}
		\item $f$是Riemann可积的. 
		\item $f$有界, 则集合$$\mathcal{A} = \left\{ \int F:0\leq F \leq f, F \in \mathcal{S}(I)  \right\}$$
		有界. 进而$\sup \mathcal{A}$存在, 令$$\int f := \sup \mathcal{A}.$$
	\end{itemize}
\end{proposition}
\begin{proof}
	(1) 应用上个命题的等价条件, 由于阶梯函数都有界, 显然$f$有界. 下证$\lim_{n\to \infty} \int f_n = \sup \mathcal{A}$. 假设该式不成立, 即存在$M,\varepsilon$使得$\lim_{n\to \infty} \int f_n < M < M+\varepsilon < \sup \mathcal{A}$, 于是对足够大的$n$均有$\int f_n < M$, 且存在阶梯函数$0\leq F \leq f$使得$\int F > M+\varepsilon$. 这就是说, $$e_n(x) > f(x)-f_n(x) \geq F(x)-f_n(x).$$
	两侧(均为非负的阶梯函数)同时积分, 即得$\int e_n(x) \geq \int F(x) - \int f_n(x) > \varepsilon >0$, 矛盾. 因此$\lim_{n\to \infty} \int f_n = \sup \mathcal{A}$. 
	
	(2) 对于$\mathcal{S}(I) \ni F,F' \geq 0$, 定义$F,F'$等价当且仅当它们的分割点集是一样的. 在每个等价类$[F]$中, 设分割点集为$\pi$, 定义该等价类的“极大项”为$$\varphi ([F]) := \sum_{i=1}^{n} \inf_{(x_{i-1},x_i)} f \cdot \chi _{(x_{i-1},x_i)}.$$
	显然$\tilde{\mathcal{A}}:=\{ \int \varphi ([F]):\mathcal{S}(I) \ni F \geq 0 \}$是$\mathcal{A}$的子集, 且$\sup \tilde{\mathcal{A}} = \sup \mathcal{A}$(为什么?). 于是取$\{ \varphi _n \} \subseteq \{ \varphi ([F]):\mathcal{S}(I) \ni F \geq 0 \}$使得$\int \varphi _n \nearrow \sup \mathcal{A}$. 这样的$\varphi _n$与其分割集$\pi _n$是一一对应的关系. 若$\int \varphi _m > \int \varphi _n$, 考虑$\tilde{\pi} = \pi _n \cup \pi _m$, 则$\tilde{\pi}$所对应的$\varphi$(不一定在该序列中)满足$\int \varphi \geq \int \varphi _m$, 将其添加到序列中. 于是我们不妨设该序列存在一个子列$\{ \varphi _{k_n} \}$, 使得对任意$n>0$, $\varphi _{k_n}$的分割点集都比$\varphi _{k_1}$的分割点集细. 令$$e_{k_n} = \sum_{i=1}^{\ell} \omega (f,(x_{i-1},x_i)) \chi _{(x_{i-1},x_i)}, $$
	其中$e_{k_n}$与$\varphi _{k_n}$的分割点集相同. 那么$f(x)-\varphi _{k_n}(x) \leq e_{k_n}(x)$. 最后, 利用命题中给出的条件, $$\int e_{k_n} = \sum_{i=1}^{\ell} \omega (f,(x_{i-1},x_i)) (x_i-x_{i-1}) \to 0, \quad \| \pi \| \to 0. $$
	这就是说$\int e_{k_n} \to 0,n \to \infty$. 
\end{proof}
\begin{remark}
	从该命题的证明中, 我们发现通过一个特殊的序列$\{ \varphi _{k_n} \}$, 可以将阶梯函数(“$n\to \infty$”)与Riemann和(“$\| \pi \|\to 0$”)联系起来. 这一思路会在下一小节会有体现. 
\end{remark}
\begin{remark}
	上述条件并不是很直白. 实际上我们后面会从连续性的角度给出一个等价条件(Lebesgue-Vitali定理): (闭区间上)有界函数可积当且仅当其不连续点组成的集合是零测集. 
\end{remark}
\begin{remark}
	从(2)的证明可以看出Riemann积分并不够好, 因为我们需要人为添加一个条件才能保证可积. 
\end{remark}


接着看一般情况: 

\begin{corollary}{}
	将上面命题的$f \geq 0$这一条件去掉, 并重新定义$\int f$如下, 原来的两条结论仍成立: 取$f^+ := \max \{ f,0 \}, f^{-} := \max \{ -f,0 \}$, 则$f=f^+-f^-$. 令$\int f = \int f^+ - \int f^-$. 
\end{corollary}
\begin{proof}
	实际上只用证明下面的引理: $f$可积当且仅当$f^+,f^-$均可积且$\int f = \int f^+ - \int f^-$. 充分性显然. 必要性: 应用Lebesgue-Vitali定理, 下证$f^+$可积, 即$D(f^+)$为零测集. 若$D(f^+) \nsubseteq D(f)$, 考虑$x_0 \in D(f^+)$但$x_0 \notin D(f)$, 那么显然$f(x_0)=0$且$f$在$x_0$两侧变号. 结合$f$在$x_0$处连续, 可知存在$\delta$使得(不妨)$f|_{(x_0-\delta,x_0)}<0,f|_{(x_0,x_0+\delta)}>0$, 这就是说$f^+|_{(x_0-\delta,x_0]}=0$, 从而$f^+|_{(x_0-\delta,x_0+\delta) = f|_{(x_0-\delta,x_0+\delta)$, 立得矛盾. 所以$D(f^+) \subseteq D(f)$, 自然是零测集. 
\end{proof}
\begin{remark}
	从上面的证明我们看出, 直接使用阶梯函数进行逼近并不够方便, 这就启发我们要研究Riemann可积和连续性的关系. 
\end{remark}


\subsection{上下积分与Darboux上下和}

现在来实现之前提到过的上下极限的想法. 需要注意, 这样的上下积分依赖于$\R$的序关系, 无法推广至$\R ^n$. 实际上, 这就是将命题\ref{pro:fwfuhjuubijb}中从一侧逼近换成了从上下两侧逼近. 具体地, 对有界函数$f$定义$$\overline{\int}f := \inf \left\{ \int F:F \geq f,F \in \mathcal{S}(I) \right\},\qquad \underline{\int}f := \sup \left\{ \int F:F \leq f,F \in \mathcal{S}(I) \right\}.$$
分别称为$f$的\textit{上积分}和\textit{下积分}. 

回顾命题\ref{pro:fwfuhjuubijb}的证明, 我们希望找到某个序列$\{ \varphi _n \}$, 在$\| \pi \| \to 0$时满足$\int \varphi _n \nearrow \underline{\int}f$. 实际上, 由先前的证明, 存在一个序列$\{ \varphi _n \}$使得$\varphi _n$的分割点集比$\varphi _{n-1}$细, 在$(x_{i-1},x_i)$上的取值恰好为$\inf_{(x_{i-1},x_i)}f$, 且有$\lim_{\| \pi \|\to 0} \int \varphi _n \nearrow \underline{\int}f$. 由此可以证明: 

\begin{proposition}{}
	设有界函数$f$. 则其在$I$上Riemann可积当且仅当$\overline{\int}f=\underline{\int}f$. 
\end{proposition}
\begin{proof}
	充分性: 记$\overline{\int}f=\underline{\int}f=I$. 由上面的论述, 存在$\{ \varphi _n \}$和$\{ \psi _n \}$使得$$\int \varphi _n \leq S(f;\pi ,\xi) \leq \int \psi _n,\qquad \int \varphi _n \nearrow I, \int \psi _n \searrow I,\| \pi \| \to 0.$$
	这就说明$\lim_{\| \pi \| \to 0}S(f;\pi ,\xi) =I$. 
	
	必要性: 类似于命题\ref{pro:fwfuhjuubijb}证明的第一部分. 
\end{proof}


接着从Riemann和的角度: 对于有界函数$f$和一个分划$\pi =\{ a=x_0<\cdots <x_n=b \}$, 定义$$\overline{S}(f;\pi):=\sum_{i=1}^{n}(x_i-x_{i-1})\sup_{x\in[x_{i-1},x_i]}f(x),\qquad \underline{S}(f;\pi):=\sum_{i=1}^{n}(x_i-x_{i-1})\inf_{x\in[x_{i-1},x_i]}f(x).$$
分别称为$f$在分划$\pi$下的\textit{Darboux上和}与\textit{Darboux下和}. 容易证明, $\overline{S}(f;\pi) = \sup_{\xi} S(f;\pi,\xi)$. 进一步, 定义$$\overline{D}(f) := \inf_{\pi} \overline{S}(f;\pi),\qquad \underline{D}(f) := \sup_{\pi} \underline{S}(f;\pi).$$
我们自然有如下的命题: (进而, 可以将上述式子称为上积分和下积分)

\begin{proposition}{}
	设有界函数$f$, 则
	\begin{center}
		$\displaystyle \overline{D}(f) = \overline{\int}f,\qquad \underline{D}(f) = \underline{\int}f.$
	\end{center}
\end{proposition}
\begin{remark}
	大家很可能注意到, 利用Darboux上下和可以轻易证明(考虑分划加细时上下和的大小变化), $f$是Riemann可积的当且仅当$\overline{D}(f)=\underline{D}(f)$, 联系此命题就给出了上个命题的另一种证明. 
\end{remark}
\begin{proof}
	以前者为例. 首先注意到, 在$(x_{i-1},x_i)$上取值为$\sup_{(x_{i-1},x_i)}f$的函数$\varphi$是一个阶梯函数, 从而$\overline{D}(f) \geq \overline{\int}f$. 
	
	另一方面, 任取阶梯函数$\varphi \geq f$, 取与其相容的分划$\pi$, 那么$$\int \varphi = \sum_{i=1}^{n} \lambda _i (x_i-x_{i-1}) \geq \sum_{i=1}^{n} \sup_{x\in[x_{i-1},x_i]}f(x) (x_i-x_{i-1}) = \overline{S}(f;\pi) \geq \overline{D}(f).$$
	 由$\varphi$的任意性, 对左侧取下确界即得$\overline{\int}f \geq \overline{D}(f)$. 这就证明了原命题. 
\end{proof}

\subsection{Riemann积分的缺陷, 反常积分}

尽管Riemann积分对大多数场景都足够了, 我们还是能够找到它的一些不足之处. 大体而言, 有如下两种缺陷: \footnote{这一节内容基本来自于\textit{Measure, Integration \& Real Analysis}, Sheldon Axler.}(实际上, 相对于Lebesgue积分而言, Riemann积分的另一个缺陷是与极限换序非常麻烦, 我们在后面再介绍)

\begin{itemize}
	\item 无法处理具有太多间断点的函数. 在下面的例子中, 我们注意到Dirichlet函数只在有理数点处为$1$, 而有理数远少于无理数, 因此其积分值应当为$0$, 但在Riemann积分这里其积分值无法定义. 
\end{itemize}

\begin{example}
	证明, Dirichlet函数Riemann不可积. 
\end{example}
\begin{proof}
	对任意$(x_{i-1},x_i)$, 其内部总存在有理数和无理数, 因此$\overline{D}(f)=1,\underline{D}(f)=0$, 从而不可积. 
\end{proof}

\begin{itemize}
	\item 无法处理定义域无限长或者无界的函数. 
\end{itemize}

当然, 通过\textit{反常积分}可以部分解决这样的问题. 具体来说, 可以定义$$\int_{a}^{+\infty} f := \lim_{N\to \infty} \int_{a}^{N} f,\qquad \int_{a}^{b} f:= \lim_{N \to b^-} \int_{a}^{N} f.$$
其中, 第二个式子表示$f$在$b$处无定义. 容易验证, 反常积分满足后面将要介绍的Newton-Leibniz公式. 

\begin{example}
	计算
	\begin{center}
		$\displaystyle \int_{-\infty}^{0} e^x \dif x,\qquad \int_{0}^{1} \ln x \dif x.$
	\end{center}
\end{example}
\begin{solution}
	应用Newton-Leibniz公式, $$\int_{-\infty}^{0} e^x \dif x = \lim_{N\to -\infty} \int_{N}^{0} e^x \dif x = \lim_{N\to -\infty} (e^0-e^N)=1,$$
	\begin{center}
		$\displaystyle \int_{0}^{1} \ln x \dif x = \lim_{N\to 0^+} \int_{N}^{1} \ln x \dif x = \lim_{N\to 0^+}((1\ln 1-1)-(N\ln N-N))=-1.$
	\end{center}
\end{solution}

但反常积分仍然无法处理较复杂的情况. 在下面的例子中, 显然每个$f_k$在$[0,1]$上的积分值小于$2$, 因此$f$在$[0,1]$上的积分值应当为小于$2$的某个数, 然而Riemann积分无法为其定义积分值. 

\begin{example}
	将$(0,1)$中的有理数排列为$r_1,\cdots ,r_n,\cdots$. 对正整数$k$, 定义$f_k(x)=\begin{cases}
		(x-r_k)^{-1/2} & x>r_k \\ 0 & x \leq r_k
	\end{cases}$. 最后令定义在$[0,1]$上的$f$满足$\displaystyle f(x)=\sum_{k=1}^{\infty} \frac{f_k(x)}{2^k}$. 由于$f$在$[0,1]$的任意子区间上无界, $f$不可积, 而且连反常积分都无法定义. 
\end{example}


\newpage
\section{Riemann可积的性质与条件}

下面的性质, 实际上在上面几节就出现过了. 

\begin{proposition}{Riemann可积的充要条件} \label{pro:kejiisyc}
	设闭区间上的函数$f$. 则$f$可积当且仅当$f$有界且
	\begin{center}
		$\displaystyle \sum_{i=1}^{n} \omega (f,(x_{i-1},x_i)) (x_i-x_{i-1}) \to 0,\quad \| \pi \| \to 0.$
	\end{center}
\end{proposition}
\begin{proof}
	先前已证明了充分性. 必要性: 注意到原式即为$\overline{S}(f;\pi) - \underline{S}(f;\pi) \to 0,\| \pi \| \to 0$. 
\end{proof}

\begin{corollary}{}
	闭区间上的连续函数Riemann可积. 
\end{corollary}
\begin{proof}
	设闭区间为$[a,b]$, 显然$f$有界. 由一致连续性, 对任意$\varepsilon >0$, 存在$\delta$使得对任意满足$\| \pi \| <\delta$的分割, 有$$\sum_{i=1}^{n} \omega (f,(x_{i-1},x_i)) (x_i-x_{i-1}) \leq \varepsilon \sum_{i=1}^{n} (x_i-x_{i-1}) = \varepsilon (b-a).$$
	令$\varepsilon \to 0$即可. 
\end{proof}

\begin{corollary}{}
	闭区间上的单调函数Riemann可积. 
\end{corollary}
\begin{remark}
	由先前的结论, 单调函数是可以有可数个间断点的, 这引导我们从间断点角度出发研究可积性. 
\end{remark}
\begin{proof}
	设闭区间为$[a,b]$, 显然$f$有界. 不妨$f$在$[a,b]$上单调不减, 则
	\begin{center}
		$\displaystyle \sum_{i=1}^{n} \omega (f,(x_{i-1},x_i)) (x_i-x_{i-1}) \leq \| \pi \| \sum_{i=1}^{n} \omega (f(x_i)-f(x_{i-1})) = \| \pi \| (f(b)-f(a)) \to 0,\quad \| \pi \| \to 0.$
	\end{center}
\end{proof}


利用Riemann和, 容易给出下面命题的证明(当然也可以通过更易推广的阶梯函数逼近来证明): 

\begin{proposition}{} \label{pro:jiffxkvi}
	设$f,g \in \mathcal{R}(I), E \subseteq I$, 则
	\begin{center}
		$1)~\forall \lambda ,\mu \in \R ,\lambda f+\mu g \in \mathcal{R}(I),\qquad 2)~|f| \in \mathcal{R}(I),\qquad 3) f|_E \in \mathcal{R}(E),\qquad 4)~fg \in \mathcal{R}(I).$
	\end{center}
\end{proposition}
\begin{remark}
	实际上, 对于一元向量值函数, 只要其值域空间定义了乘法, 4)仍然成立. 
\end{remark}
\begin{proof}
	1)是显然的. 2)只需利用命题\ref{pro:kejiisyc}即可. 
	
	3) 核心的想法是将区间$E$的两端点$a,b$作为固定的分割点处理. 具体地, 对每个分割$\pi$, 在其中增加两点$a,b$得到$\pi '$, 显然$\| \pi ' \| \leq \| \pi \|$, 再利用命题\ref{pro:kejiisyc}即可. 
	
	4) 我们注意到, $(f \cdot g)(x) = \frac{1}{4}((f+g)^2(x)-(f-g)^2(x))$, 因此不妨$f=g$, 即验证$f^2 \in \mathcal{R}(I)$. 实际上, 设$f$的一个界为$M$, 则
	\begin{center}
		$|f^2(x_1)-f^2(x_2)| \leq 2M|f(x_1)-f(x_2)| \quad \Rightarrow \quad \omega (f^2,(x_{i-1},x_i)) \leq 2M\omega (f,(x_{i-1},x_i)).$
	\end{center}
	再利用命题\ref{pro:kejiisyc}即可. 
\end{proof}


类似于阶梯函数积分算子的性质, 对一般的积分算子也有如下性质: 

\begin{proposition}{}
	设闭区间$I=[a,b]$. 设$f,g \in \mathcal{R}(I)$. 则$\int : \mathcal{R}(I) \to \R$满足: 
	
	a) 线性: $$\int (\lambda f+ \mu g) = \lambda \int f + \mu \int g.$$
	
	b) 区间可加性: 设$I=[a,c] \cup [c,b]$, 则$$\int_a^b f = \int_a^c f + \int_c^b f. $$
	
	c) 三角不等式: $$\left| \int f \right| \leq \int |f|. $$
	
	d) 保号性/保序性: 若$f \geq 0$, 则$$\int f \geq 0. $$
	\qquad 特别地, 若$f \leq g$, 则$$ \int f \leq  \int g.$$
	
	e) 对积分的估计: 选取与$f$相容的分划$\pi= \{ a=x_0<\cdots <x_n=b \}$后, $$\left| \int_a^b f \right| \leq |b-a| \sup_{1 \leq i \leq n} |\lambda _i|. $$
\end{proposition}

在之前我们已引入了零测集的概念, 即称$E$为零测集, 若对任意$\varepsilon >0$都存在至多可数个开区间$\{ I_n \}$构成$E$的开覆盖, 且$\sum_{n=0}^{\infty} |I_n|<\varepsilon$. 需要注意, 这里由于$\sum_{n=0}^{\infty} |I_n|$绝对收敛, 其求和顺序对结果无影响. 

\begin{lemma}{}
	1) 至多可数的集合是零测集. \qquad 2) 至多可数个零测集的并集是零测集. 
	
	\noindent
	3) 设$a<b$, 则闭区间$[a,b]$不是零测集. 
\end{lemma}
\begin{remark}
	实际上可以证明, $[a,b]$的外测度就是$b-a$. 
\end{remark}
\begin{proof}
	1) 只要证明可数集是零测集, 因为显然零测集的子集是零测集. 设该集合$E=\{ x_0,\cdots ,x_n,\cdots \}$, 令$I_k=(x_k-\varepsilon 2^{-k},x_k+\varepsilon 2^{-k})$, 则$\{ I_n \}$覆盖$E$且$\sum_{|I_k|} = 4\varepsilon$, 令$\varepsilon \to 0$即可.
	
	2) 设可数个零测集$E_1,\cdots ,E_n,\cdots$. 任取$\varepsilon >0$, 存在$\{ I_n^i \}_{i \geq 0}$覆盖$E$且$\sum_{i=0}^{\infty} |I_n^i| < \varepsilon 2^{-n}$, 因此$\{ I_n^i \}_{i\geq 0,n\geq 1}$覆盖$\bigcup_{n=1}^{\infty} E_n$且$$\sum_{i\geq 0,n\geq 1}|I_n^i| = \sum_{n=1}^{\infty} \sum_{i=0}^{\infty} |I_n^i| \leq \sum_{n=1}^{\infty} \frac{\varepsilon}{2^n} = \varepsilon .$$
	令$\varepsilon \to 0$即可. 
	
	3) 设$\{ I_n \}$是$[a,b]$的开覆盖, 由有限覆盖定理, 不妨设$I_1,\cdots ,I_n$构成开覆盖, 下面对$n$归纳证明$\sum_{k=1}^{n} |I_k| \geq b-a$. $n=1$的情况是显然的, 假设$n$时成立, 则若$[a,b] \subseteq I_1 \cup \cdots \cup I_{n+1}$, 不妨$b \in I_{n+1} = (c,d)$, 其中$a<c<b<d$. 对前$n$项用归纳假设, 有$\sum_{k=1}^{n+1} |I_k| \geq (c-a)+|I_{n+1}| = c-a+d-c \geq b-a$. 
\end{proof}

在下面的命题中, \textit{几乎处处$\cdots$}(almost everywhere)指的是除了在一个零测集上以为均$\cdots$. 

\begin{theorem}{Lebesgue-Vitali定理}
	设闭区间上的函数$f$. 则$f$可积当且仅当$f$有界且在闭区间上几乎处处连续. 
\end{theorem}
\begin{proof}
	(1)必要性. 先证明一个关键的引理: 若$f$可积, 则对任意$\varepsilon >0$, $\Omega _{\varepsilon} (f) = \{ x\in [a,b]:\omega (f,x)\geq \varepsilon \}$是零测集. 从而, $f$的间断点集$D(f)=\bigcup_{n\geq 1}\Omega _{1/n}(f)$是零测集. 这里使用阶梯函数逼近给出证明: 
	
	取阶梯函数$F,e$使得$|f(x)-F(x)| \leq e(x), \int_a^b e \leq \delta$(其中$\delta$待定), 对应分划$\pi$. 在一个区间$(x_{i-1},x_i)$上, 注意到$|f(x)-f(y)| \leq |f(x)-F(x)| + |f(y)-F(y)| + |F(x)-F(y)| \leq |e(x)|+|e(y)|$, 因此只要$e$在该区间的取值小于$\varepsilon /2$, 该区间就与$\Omega _{\varepsilon}(f)$不交, 或者说其余的区间构成$\Omega _{\varepsilon}(f)$的一个开覆盖. 对这些区间的长度进行估计: 实际上$$\sum_{e_i \geq \varepsilon /2} \frac{\varepsilon}{2} (x_{i}-x_{i-1}) \leq \sum_{e_i \geq \varepsilon /2} e_i (x_{i}-x_{i-1}) \leq \int_a^b e\leq \delta .$$
	因此其长度之和不超过$\frac{2\delta}{\varepsilon}$, 令$\delta \to 0$即可. 
	
	(2) 充分性. 核心想法是对$\varepsilon >0$, 找到$D(f)$的一个开覆盖$\{ I_n \}$, 讨论每个小区间$(x_{i-1},x_i)$和这些$I_n$有无交集的情况. 令$K=[a,b] \setminus \bigcup_{n\geq 1}I_n$, 那么$K$是有界闭集, 从而是紧集. 记$\alpha _1 =\{ i:K \cap (x_{i-1},x_i) \neq \varnothing \}, \alpha _2 =\{ i:K \cap (x_{i-1},x_i) = \varnothing \}$. 
	
	首先考虑$\alpha _1$部分. 由$K$是紧集, 对任意$\varepsilon >0$存在$\delta >0$使得只要$x_i-x_{i-1}<\delta$就有$\omega (f,(x_{i-1},x_i)) \leq \omega (f,(x_{i-1},y)) + \omega (f,(y,x_i)) <2\varepsilon$, 其中$y \in K\cap (x_{i-1},x_i)$. 因此$\sum_{i \in \alpha _1} \omega (f,(x_{i-1},x_i))(x_i-x_{i-1}) < 2\varepsilon (b-a)$. 
	
	接着看$\alpha _2$部分. 将$\omega (f,(x_{i-1},x_i))$放缩为$f$在$[a,b]$上的振幅$\omega$, 我们只需考虑$\omega\sum_{i \in \alpha _2} (x_i-x_{i-1}) \leq \omega \sum_{k \geq 0} |I_k| < \omega \varepsilon$. 
	
	综上所述, $\sum_{i=1}^{n} \omega (f,(x_{i-1},x_i))(x_i-x_{i-1}) < (2(b-a)+\omega)\varepsilon$, 令$\varepsilon \to 0$即可. 
\end{proof}

利用Lebesgue-Vitali定理, 我们可以快速得到先前的一些结果, 例如命题\ref{pro:jiffxkvi}. 



\newpage
\section{Riemann积分的计算}

\subsection{Newton-Leibniz公式}

下面我们来研究这样一类由Riemann积分所定义的函数: 称形如$F(x)=\int_a^x f(t) \dif t$的函数$F:[a,b] \to \R$为$f$的\textit{变上限积分函数}, 类似可以定义变下限积分函数. 

在这个命题中, 我们看到积分让函数的性质变得更好了. 

\begin{proposition}{}
	设$f \in \mathcal{R}([a,b])$, 则$F(x):=\int_a^x f(t) \dif t$在$[a,b]$上Lipschitz连续. 
\end{proposition}
\begin{proof}
	设$f$有界$M$. 任取$a \leq x_1 < x_2 \leq b$, 则$$|F(x_2)-F(x_1)| = |\int_{x_1}^{x_2} f(t) \dif t| \leq \int_{x_1}^{x_2} |f(t)| \dif t \leq M(x_2-x_1).$$
	这就说明$F$在$[a,b]$上Lipschitz连续. 
\end{proof}

\begin{theorem}{微积分基本定理}
	设$f \in \mathcal{R}([a,b])$, 同上定义$F$. 若$f$在$x_0$处连续, 则$F$在$x_0$处可导, 且$F'(x_0)=f(x_0)$. 
\end{theorem}
\begin{proof}
	在$x_0$附近, 有$f(t)=f(x_0)+\alpha (t)$, 其中$\alpha (t)=o(t-x_0)$, 记$\alpha (t)$的一个界为$M$. 计算$$F(x_0+h)-F(x_0)=\int_{x_0}^{x_0+h} (f(x_0)+\alpha (t)) \dif t = f(x_0)h+\int_{x_0}^{x_0+h} \alpha (t) \dif t.$$
	令$\int_{x_0}^{x_0+h}\alpha (t) \dif t=\beta (h)$, 容易证明$|\beta (h)| \leq \int_{x_0}^{x_0+h} |\alpha (t)| \dif t \leq Mh$, 故$\beta (h)=o(h)$, 这就说明$F'(x_0)=f(x_0)$. 
\end{proof}

该定理的直接推论是: 连续函数$f$一定存在原函数, 且形如$\int_a^x f(t) \dif t$. 

\begin{theorem}{Newton-Leibniz公式, 弱形式}
	设$f \in \mathcal{R}([a,b])$, $F$是$f$在$[a,b]$上(除去有限个点以外的)一个原函数, 则$\int_a^b f(x) \dif x = F(b)-F(a)$. 
\end{theorem}
\begin{proof}
	若$F'=f$在$[a,b]$上均成立, 则由微积分基本定理可得. 若在$x_1,\cdots ,x_n$上不成立, 只需分别计算$\int_a^{x_1},\cdots ,\int_{x_n}^{b}$再求和即可. 
\end{proof}

\begin{theorem}{Newton-Leibniz公式, 强形式}
	设$f \in \mathcal{R}([a,b])$, $F$是$f$在$[a,b]$上(除去可数个点以外的)一个原函数, 则$\int_a^b f(x) \dif x = F(b)-F(a)$. 
\end{theorem}


\subsection{Riemann积分的中值定理}





\newpage
\section{积分的一些应用}










\newpage
\section{补充: Stieltjes积分}